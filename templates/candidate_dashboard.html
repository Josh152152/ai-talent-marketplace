<!DOCTYPE html>
<html>
<head>
  <title>Candidate Dashboard</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 40px;
    }
    .suggestion-box {
      border: 1px solid #ccc;
      padding: 16px;
      border-radius: 12px;
      margin-top: 24px;
      background: #f9f9f9;
    }
    #suggested-skills-list li {
      margin-bottom: 8px;
    }
  </style>
</head>
<body>
  <h2>Welcome, {{ data.Email }}</h2>

  <p><strong>Your Current Skills:</strong> {{ data.Skills }}</p>

  <form method="POST" action="/update_skills">
    <input type="hidden" name="email" value="{{ data.Email }}"> <!-- Include email in form -->
    <label for="skills">Update Skills (comma-separated):</label><br><br>
    <input type="text" name="skills" id="skills" value="{{ data.Skills }}"><br><br>
    <button type="submit">Update</button>
  </form>

  <!-- ðŸ” AI Skill Suggestions Section -->
  <div id="skill-suggestions" class="suggestion-box">
    <h3>ðŸš€ AI Skill Suggestions to Boost Your Job Matches</h3>
    <button onclick="fetchSuggestedSkills()">Get Skill Suggestions</button>
    <ul id="suggested-skills-list"></ul>
  </div>

  <br>
  <a href="/logout">Log out</a>

  <script>
    const userEmail = "{{ data.Email }}";

    async function fetchSuggestedSkills() {
      const response = await fetch("/suggest_skills", {
        method: "POST",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify({ email: userEmail })
      });

      const result = await response.json();
      const skillList = document.getElementById("suggested-skills-list");
      skillList.innerHTML = "";

      if (result.suggested_skills && result.suggested_skills.length > 0) {
        result.suggested_skills.forEach(skill => {
          const li = document.createElement("li");
          li.textContent = `ðŸ§  Learn "${skill.skill}" to unlock +${skill.extra_jobs_unlocked} more job postings`;
          skillList.appendChild(li);
        });
      } else {
        const li = document.createElement("li");
        li.textContent = "No suggestions available yet. Try updating your skills or location.";
        skillList.appendChild(li);
      }
    }
  </script>
</body>
</html>
